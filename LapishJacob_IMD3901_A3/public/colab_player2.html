<!DOCTYPE html>
<html>
    <head>
        <title>Player 2 find the end</title>
        <meta charset="utf-8" />
        <script src="https://aframe.io/releases/1.1.0/aframe.min.js"></script>
        <script src = "../aframe-extras.js"></script>
        <script src="https://unpkg.com/super-hands@2.1.0/dist/super-hands.min.js"></script>
        <script src="//cdn.rawgit.com/donmccurdy/aframe-extras/v3.13.1/dist/aframe-extras.min.js"></script>
        <script src=/socket.io/socket.io.js></script>
    </head>

    <body>
        <a-scene background="color:rgb(0, 0, 0);" physics="gravity:-9.8" shadow="autoUpdate: false" light="defaultLightsEnabled: false">
            <a-entity camera universal-controls look-controls position="0 1.6 0" kinematic-body>
                <a-entity cursor="rayOrigin:mouse;" raycaster="far:20; interval:200; objects:.interactive"></a-entity>
            </a-entity>
            <a-entity light="type:ambient; castShadow:false;" position="0 1 0"></a-entity>
            <a-entity class="ground" static-body geometry="primitive:plane; width:50; height:50;" material="color:rgb(0,0,0);" position="0 0.01 0" rotation="90 0 0"></a-entity>
            <a-entity static-body geometry="primitive:plane; width:50; height:50;" material="color:rgb(0, 0, 0);" position="25 0 0" rotation="0 90 90"></a-entity>
            <a-entity static-body geometry="primitive:plane; width:50; height:50;" material="color:rgb(0, 0, 0);" position="-25 0 0" rotation="0 270 90"></a-entity>
            <a-entity static-body geometry="primitive:plane; width:50; height:50;" material="color:rgb(0, 0, 0);" position="0 0 -25" rotation="0 180 90"></a-entity>
            <a-entity static-body geometry="primitive:plane; width:50; height:50;" material="color:rgb(0, 0, 0);" position="0 0 25" rotation="0 0 90"></a-entity>

            <a-entity static-body geometry="primitive:plane; width:20; height:20;" material="color:rgb(0, 0, 0);" position="-3 0 -8" rotation="0 90 90"></a-entity>
            <a-entity static-body geometry="primitive:plane; width:20; height:20;" material="color:rgb(0, 0, 0);" position="3 0 -8" rotation="0 270 90"></a-entity>
            <a-entity static-body geometry="primitive:plane; width:20; height:14;" material="color:rgb(0, 0, 0);" position="0 0 2" rotation="0 180 90"></a-entity>

            <a-entity static-body geometry="primitive:plane; width:20; height:14;" material="color:rgb(255, 0, 0);" position="8 0 -20" rotation="0 270 90"></a-entity>
            <a-entity static-body geometry="primitive:plane; width:20; height:14;" material="color:rgb(255, 0, 0);" position="10 0 -18" rotation="0 -180 90"></a-entity>

            <a-entity static-body geometry="primitive:plane; width:20; height:14;" material="color:rgb(255, 0, 0);" position="-17 0 -11" rotation="0 270 90"></a-entity>
            <a-entity static-body geometry="primitive:plane; width:20; height:14;" material="color:rgb(255, 0, 0);" position="-17 0 3" rotation="0 270 90"></a-entity>
            <a-entity static-body geometry="primitive:plane; width:20; height:14;" material="color:rgb(0, 0, 255);" position="-10 0 -18" rotation="0 -180 90"></a-entity>

            <a-entity static-body geometry="primitive:plane; width:20; height:14;" material="color:rgb(0, 0, 255);" position="-10 0 10" rotation="0 0 90"></a-entity>
            <a-entity static-body geometry="primitive:plane; width:20; height:12;" material="color:rgb(0, 0, 255);" position="2 0 10" rotation="0 0 90"></a-entity>

            <a-entity static-body geometry="primitive:plane; width:20; height:14;" material="color:rgb(255, 0, 0);" position="8 0 -11" rotation="0 90 90"></a-entity>
            <a-entity static-body geometry="primitive:plane; width:20; height:14;" material="color:rgb(255, 0, 0);" position="8 0 3" rotation="0 90 90"></a-entity>

            <a-entity static-body geometry="primitive:plane; width:20; height:14;" material="color:rgb(255, 0, 0);" position="15 0 -11" rotation="0 270 90"></a-entity>
            <a-entity static-body geometry="primitive:plane; width:20; height:14;" material="color:rgb(255, 0, 0);" position="15 0 3" rotation="0 270 90"></a-entity>
            <a-entity static-body geometry="primitive:plane; width:20; height:14;" material="color:rgb(0, 0, 255);" position="15 0 -11" rotation="0 90 90"></a-entity>
            <a-entity static-body geometry="primitive:plane; width:20; height:14;" material="color:rgb(0, 0, 255);" position="15 0 3" rotation="0 90 90"></a-entity>

            <a-entity static-body geometry="primitive:plane; width:20; height:14;" material="color:rgb(255, 0, 0);" position="8 0 -20" rotation="0 90 90"></a-entity>
            <a-entity static-body geometry="primitive:plane; width:20; height:10;" material="color:rgb(255, 0, 0);" position="10 0 -18" rotation="0 180 90"></a-entity>
            <a-entity static-body geometry="primitive:plane; width:20; height:10;" material="color:rgb(255, 0, 0);" position="10 0 -18" rotation="0 0 90"></a-entity>

            <a-entity id="end_button" position="10 0.7 -20">
                <a-entity class="button interactive" position="0 0 0" geometry="primitive:cylinder; radius:0.15; height:0.2;" material="color:rgb(100, 255, 100)"
                            animation__mouseenter="property:material.color; type:color; to:rgb(0, 255, 0); startEvents:mouseenter; dur:200"
                            animation__mouseleave="property:material.color; type:color; to:rgb(100, 255, 100); startEvents:mouseleave; dur:200"
                            animation__click="property:position.y; from:-0.1; to:0; startEvents:click; dur:300" shadow></a-entity>
                <a-entity position="0 -0.3 0" geometry="primitive:box; width:0.5; depth:0.5; height:0.5;" material="color:rgb(255, 255, 255)" shadow></a-entity>
            </a-entity>

            <!-- red button -->
            <a-entity id="red_button" position="2 0 -1">
                <a-entity class="button interactive" position="0 0 0" geometry="primitive:cylinder; radius:0.15; height:0.2;" material="color:rgb(255, 100, 100)"
                            animation__mouseenter="property:material.color; type:color; to:rgb(255, 0, 0); startEvents:mouseenter; dur:200"
                            animation__mouseleave="property:material.color; type:color; to:rgb(255, 100, 100); startEvents:mouseleave; dur:200"
                            animation__click="property:position.y; from:0.55; to:5; startEvents:click; dur:300" shadow></a-entity>
                <a-entity position="0 0.3 0" geometry="primitive:box; width:0.5; depth:0.5; height:5;" material="color:rgb(255, 255, 255)" shadow></a-entity>
            </a-entity>

            <!-- blue button -->
            <a-entity id="blue_button" position="-2 0 -1">
                <a-entity class="button interactive" position="0 0 0" geometry="primitive:cylinder; radius:0.15; height:0.2;" material="color:rgb(100, 100, 255)"
                            animation__mouseenter="property:material.color; type:color; to:rgb(0, 0, 255); startEvents:mouseenter; dur:200"
                            animation__mouseleave="property:material.color; type:color; to:rgb(100, 100, 255); startEvents:mouseleave; dur:200"
                            animation__click="property:position.y; from:0.55; to:5; startEvents:click; dur:300" shadow></a-entity>
                <a-entity position="0 0.3 0" geometry="primitive:box; width:0.5; depth:0.5; height:5;" material="color:rgb(255, 255, 255)" shadow></a-entity>
            </a-entity>
        </a-scene>

        <script>
            let socket = io();

                socket.on('connect', (data) =>{
                    document.querySelector('#red_button').querySelector('.button').addEventListener('click', function(){
                        socket.emit('red');
                    });

                    document.querySelector('#blue_button').querySelector('.button').addEventListener('click', function(){
                        socket.emit('blue');
                    });
                    socket.on('color_change', (data) =>{
                    let colorStr = 'rgb('+ data.r +','+ data.g + ',' + data.b +')';
                    document.querySelector('a-scene').setAttribute('background', {color:colorStr});

                    console.log('color_change: ' + colorStr);

                    document.querySelector('#end_button').querySelector('.button').addEventListener('click', function(){
                        socket.emit('end');
                    });
                });
            });
        </script>
    </body>
</html>